<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!--Set visual viewport size for mobile devices to the device size,
        witch results in a scale of 1 and a 1:1 mapping between CSS pixels
        and Qt device independent pixels. -->
    <meta name="viewport" content="width=device-width, height=device-height, user-scalable=0"/>

    <title>project_qt</title>
    <style>
      /* Make the html body cover the entire (visual) viewport with no scroll bars. */
      html, body { padding: 0; margin: 0; overflow:hidden; height: 100vh }
      /* the canvas *must not* have any border or padding, or mouse coords will be wrong */
      canvas { border: 0px none; background-color: white; height:100%; width:100%;  }
      /* The contenteditable property is set to true for the canvas in order to support
         clipboard events. Hide the resulting focus frame and set the cursor back to
         the default cursor. */
      canvas { outline: 0px solid transparent; caret-color: transparent; cursor:default }
	.first {
	            width: 80%;
	            float:left;
	            height: 100%;
/* 	            border: 1px solid #3B6273;
 */	        }
	        .second {
	            width: 20%;
	            float:left;
	            height: 100%;
/* 	            border: 1px solid #3B6273;
 */	        }
	</style>
  </head>
  <body onload="init()">
	<div class="first"> 
    <figure style="overflow:visible;" id="qtspinner">
      <center style="margin-top:1.5em; line-height:150%">
        <img src="qtlogo.svg" width="320" height="200" style="display:block"></img>
        <strong>Qt for WebAssembly: project_qt</strong>
        <div id="qtstatus"></div>
        <noscript>JavaScript is disabled. Please enable JavaScript to use this application.</noscript>
      </center>
    </figure>
    <canvas id="qtcanvas" oncontextmenu="event.preventDefault()" contenteditable="true"></canvas>

    <script type='text/javascript'>
        function init() {
          var spinner = document.querySelector('#qtspinner');
          var canvas = document.querySelector('#qtcanvas');
          var status = document.querySelector('#qtstatus')

          var qtLoader = QtLoader({
              canvasElements : [canvas],
              showLoader: function(loaderStatus) {
                  spinner.style.display = 'block';
                  canvas.style.display = 'none';
                  status.innerHTML = loaderStatus + "...";
              },
              showError: function(errorText) {
                  status.innerHTML = errorText;
                  spinner.style.display = 'block';
                  canvas.style.display = 'none';
              },
              showExit: function() {
                  status.innerHTML = "Application exit";
                  if (qtLoader.exitCode !== undefined)
                      status.innerHTML += " with code " + qtLoader.exitCode;
                  if (qtLoader.exitText !== undefined)
                      status.innerHTML += " (" + qtLoader.exitText + ")";
                  spinner.style.display = 'block';
                  canvas.style.display = 'none';
              },
              showCanvas: function() {
                  spinner.style.display = 'none';
                  canvas.style.display = 'block';
              },
          });
          qtLoader.loadEmscriptenModule("project_qt");
      }
    </script>
    <script type="text/javascript" src="qtloader.js"></script>
	</div>
	
	<div class="second"> 
	<script type="text/javascript">
	  // Module.onRuntimeInitialized = function showString() {

	function showString() {
	    // 第一次调用先获取需要的内存大小
	    var size = Module._get_c_string(0, 0);
	    var strPointer = Module._malloc(size);
	    Module._get_c_string(strPointer, size);
	    var strBuffer = new Uint8Array(Module.HEAPU8.buffer, strPointer, size - 1);
	    var str = new TextDecoder().decode(strBuffer);
	    console.log(str); // Hello World
      articles = str.split('_NEW_SOURCE').splice(1, 46);
		  //document.getElementById("textshow").value = articles;
      //console.log(articles);      
    const resposne = fetch( 'https://flask-summarize.herokuapp.com/model', {
        method: 'POST',
        type: "json",
        body: JSON.stringify({"articles": articles}),
        headers: { 'Content-Type': 'application/json'}
      });

      var len;
      var jsonArray = [];
      resposne.then(res => res.json())
      .then(json => 
            {
              console.log(json);
              //jsonArray = JSON.stringify(json);
              len=eval(json).length;

              if(len==45){
                clearInterval(id);
                alert("getting summaries!");
                console.log("json's length %f",len);
              for(var i=0;i<len;i++){
                // console.log("json[i]");
                // console.log(json[i]);
                jsonArray[i]=json[i].Summary;
                jsonArray[i]=jsonArray[i].replace(/NEW_LINE/gi,'');

                // console.log("json array");
                // console.log(jsonArray[i]);
              }
                document.getElementById("summary1").value = "Cluster 1 Summary: \n" + jsonArray[0];
                document.getElementById("summary2").value = "Cluster 2 Summary: \n" + jsonArray[1];
                document.getElementById("summary3").value = "Cluster 3 Summary: \n" + jsonArray[2];
                document.getElementById("summary4").value = "Cluster 4 Summary: \n" + jsonArray[3];
                document.getElementById("summary5").value = "Cluster 5 Summary: \n" + jsonArray[4];
                document.getElementById("summary6").value = "Cluster 6 Summary: \n" + jsonArray[5];
                console.log("done");
              }else{
                console.log("pending");
              }
              
            }).catch(err => {
              current_count=0;
              console.log(err);
              return "ERROR"});
	    Module._free(strPointer);
    
	  }

    for(var index=0;index<100000;index++){
          if(index == 100000)){
      var id=setInterval(showString(),6000);
    }
  }
    


	</script>
	<!-- <input type="button" value="press to get summaries" onclick="showString()" /> -->
	<form>
	    <textarea name="description" id="summary1" cols="53" rows="10" placeholder="show text" style="font-size:10px;font-family: 'Times New Roman', Times, serif;"> </textarea>
      <textarea name="description" id="summary2" cols="53" rows="10" placeholder="show text" style="font-size:10px;font-family: 'Times New Roman', Times, serif;"> </textarea>
	    <textarea name="description" id="summary3" cols="53" rows="10" placeholder="show text" style="font-size:10px;font-family: 'Times New Roman', Times, serif;"> </textarea>
	    <textarea name="description" id="summary4" cols="53" rows="10" placeholder="show text" style="font-size:10px;font-family: 'Times New Roman', Times, serif;"> </textarea>
	    <textarea name="description" id="summary5" cols="53" rows="10" placeholder="show text" style="font-size:10px;font-family: 'Times New Roman', Times, serif;"> </textarea>
	    <textarea name="description" id="summary6" cols="53" rows="10" placeholder="show text" style="font-size:10px;font-family: 'Times New Roman', Times, serif;"> </textarea>
    </form>
	</div>


</html>
<script type="module" src="./main.js"></script>
<link href="./style.css" rel="stylesheet">
